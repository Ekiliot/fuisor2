# –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è SQL –º–∏–≥—Ä–∞—Ü–∏–π –¥–ª—è –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

## ‚ö†Ô∏è –í–ê–ñ–ù–û: –í—ã–ø–æ–ª–Ω—è–π—Ç–µ —Å—Ç—Ä–æ–≥–æ –ø–æ –ø–æ—Ä—è–¥–∫—É!

### 1. –°–Ω–∞—á–∞–ª–∞: –î–æ–±–∞–≤–∏—Ç—å –∫–æ–ª–æ–Ω–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü—É messages
–§–∞–π–ª: `supabase/migrations/add_voice_messages.sql`

```sql
-- –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª—è –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –º–µ–¥–∏–∞-—Å–æ–æ–±—â–µ–Ω–∏–π
```

‚úÖ –≠—Ç–∞ –º–∏–≥—Ä–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –ø—Ä–æ–π—Ç–∏ –±–µ–∑ –æ—à–∏–±–æ–∫.

---

### 2. –ü–æ—Ç–æ–º: –°–æ–∑–¥–∞—Ç—å bucket –∏ RLS –ø–æ–ª–∏—Ç–∏–∫–∏
–§–∞–π–ª: `supabase/setup_dm_media_bucket.sql`

```sql
-- –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–µ—Ç bucket –∏ –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞
```

‚úÖ –≠—Ç–∞ –º–∏–≥—Ä–∞—Ü–∏—è –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–π (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç chat_participants).

---

## üîç –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

RLS –ø–æ–ª–∏—Ç–∏–∫–∞ –¥–ª—è —á—Ç–µ–Ω–∏—è –º–µ–¥–∏–∞ —É–ø—Ä–æ—â–µ–Ω–∞:
- –¢–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —É—á–∞—Å—Ç–∏–µ —á–µ—Ä–µ–∑ `chat_participants`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—É—Ç—å —Ñ–∞–π–ª–∞: `userId/chatId/timestamp.m4a`
- –ù–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–∞–±–ª–∏—Ü—ã `messages`

---

## ‚úÖ –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ bucket —Å–æ–∑–¥–∞–Ω:
1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard
2. Storage ‚Üí Buckets
3. –î–æ–ª–∂–µ–Ω –±—ã—Ç—å bucket `dm_media` (private)

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª–∏—Ç–∏–∫–∏:
```sql
SELECT * FROM pg_policies WHERE tablename = 'objects' AND schemaname = 'storage';
```

–î–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ–ª–∏—Ç–∏–∫–∏:
- `Users can upload their own DM media`
- `Users can read DM media from their chats`
- `Users can delete their own DM media`

