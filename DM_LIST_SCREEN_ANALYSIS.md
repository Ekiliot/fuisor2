# üìä –ê–Ω–∞–ª–∏–∑ —ç–∫—Ä–∞–Ω–∞ —Å–ø–∏—Å–∫–∞ –ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (ChatsListScreen)

## üîç –û–±–∑–æ—Ä
–≠–∫—Ä–∞–Ω `ChatsListScreen` –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —á–∞—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –ø–æ–∏—Å–∫–∞ –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—Ç–∞—Ç—É—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

---

## ‚ùå –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**

#### üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ: –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤
**–ü—Ä–æ–±–ª–µ–º–∞:** –°—Ç–∞—Ç—É—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –≤ —Ü–∏–∫–ª–µ `for`, —á—Ç–æ –æ—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω–æ –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —á–∞—Ç–æ–≤.

```dart
// –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (—Å—Ç—Ä–æ–∫–∏ 51-69)
for (final chat in _chats) {
  if (chat.otherUser != null) {
    final status = await onlineStatusProvider.getUserStatus(...); // ‚ö†Ô∏è –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ!
  }
}
```

**–í–ª–∏—è–Ω–∏–µ:** –ü—Ä–∏ 10 —á–∞—Ç–∞—Ö = 10 –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ = ~2-5 —Å–µ–∫—É–Ω–¥ –∑–∞–¥–µ—Ä–∂–∫–∏.

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Future.wait()` –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏:
```dart
final statusFutures = _chats
    .where((chat) => chat.otherUser != null)
    .map((chat) => onlineStatusProvider.getUserStatus(chat.otherUser!.id, accessToken))
    .toList();
final statuses = await Future.wait(statusFutures);
```

#### üü° –°—Ä–µ–¥–Ω–µ: –ù–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫—ç—à–∞ —Å—Ç–∞—Ç—É—Å–æ–≤
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `getCachedStatus()` –∏–∑ `OnlineStatusProvider`, —Ö–æ—Ç—è –∫—ç—à —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.

**–†–µ—à–µ–Ω–∏–µ:** –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∫—ç—à, –∑–∞—Ç–µ–º –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ —Å—Ç–∞—Ç—É—Å—ã.

#### üü° –°—Ä–µ–¥–Ω–µ: –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –∏–∑ —á–∞—Ç–∞
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –∏–∑ `ChatScreen` –≤—Å–µ–≥–¥–∞ –¥–µ–ª–∞–µ—Ç—Å—è –ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ (—Å—Ç—Ä–æ–∫–∞ 264).

**–†–µ—à–µ–Ω–∏–µ:** –û–±–Ω–æ–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —á–∞—Ç—ã –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å callback –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —á–∞—Ç–∞.

---

### 2. **UI/UX –ø—Ä–æ–±–ª–µ–º—ã**

#### üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ: –ö–æ–Ω—Ñ–ª–∏–∫—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ –Ω–∞ –∞–≤–∞—Ç–∞—Ä–µ
**–ü—Ä–æ–±–ª–µ–º–∞:** –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (–≤–≤–µ—Ä—Ö—É —Å–ø—Ä–∞–≤–∞) –∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ–Ω–ª–∞–π–Ω (–≤–Ω–∏–∑—É —Å–ø—Ä–∞–≤–∞) –º–æ–≥—É—Ç –≤–∏–∑—É–∞–ª—å–Ω–æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å, –æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ –æ–±–∞ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç.

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –ù–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ: `Positioned(right: 0, top: 0)` - —Å–∏–Ω–∏–π –±–µ–π–¥–∂ —Å —á–∏—Å–ª–æ–º
- –û–Ω–ª–∞–π–Ω: `Positioned(right: 0, bottom: 0)` - –∑–µ–ª–µ–Ω—ã–π –∫—Ä—É–∂–æ–∫

**–†–µ—à–µ–Ω–∏–µ:** 
- –ï—Å–ª–∏ –µ—Å—Ç—å –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ > 0, –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –±–µ–π–¥–∂ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö
- –û–Ω–ª–∞–π–Ω –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ—Ç –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π –≤–∏–∑—É–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–µ–ª–µ–Ω—É—é –æ–±–≤–æ–¥–∫—É –∞–≤–∞—Ç–∞—Ä–∞ –¥–ª—è –æ–Ω–ª–∞–π–Ω)

#### üü° –°—Ä–µ–¥–Ω–µ: –°—Ç–∞—Ç—É—Å-–±–µ–π–¥–∂ –∑–∞–Ω–∏–º–∞–µ—Ç –º–Ω–æ–≥–æ –º–µ—Å—Ç–∞
**–ü—Ä–æ–±–ª–µ–º–∞:** –°—Ç–∞—Ç—É—Å-–±–µ–π–¥–∂ —Å–ø—Ä–∞–≤–∞ –æ—Ç –∏–º–µ–Ω–∏ (—Å—Ç—Ä–æ–∫–∏ 356-381) –º–æ–∂–µ—Ç –æ–±—Ä–µ–∑–∞—Ç—å –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö.

**–†–µ—à–µ–Ω–∏–µ:** 
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å-–±–µ–π–¥–∂ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –º–µ—Å—Ç–∞
- –ò–ª–∏ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –µ–≥–æ –ø–æ–¥ –∏–º–µ–Ω–µ–º
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π –¥–∏–∑–∞–π–Ω

#### üü° –°—Ä–µ–¥–Ω–µ: Stories —Å–µ–∫—Ü–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ –Ω—É–∂–Ω–∞
**–ü—Ä–æ–±–ª–µ–º–∞:** Stories —Å–µ–∫—Ü–∏—è (—Å—Ç—Ä–æ–∫–∏ 435-587) –Ω–∞ —ç–∫—Ä–∞–Ω–µ —Å–æ–æ–±—â–µ–Ω–∏–π –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–∑–±—ã—Ç–æ—á–Ω–æ–π. –û–±—ã—á–Ω–æ Stories –Ω–∞—Ö–æ–¥—è—Ç—Å—è –Ω–∞ –≥–ª–∞–≤–Ω–æ–º —ç–∫—Ä–∞–Ω–µ.

**–†–µ—à–µ–Ω–∏–µ:** –°–¥–µ–ª–∞—Ç—å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –∏–ª–∏ —É–±—Ä–∞—Ç—å, –µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞–∫—Ç–∏–≤–Ω–æ.

#### ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: Debounce –¥–ª—è –ø–æ–∏—Å–∫–∞
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–∏—Å–∫ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–ª –Ω–∞ –∫–∞–∂–¥–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –±–µ–∑ –∑–∞–¥–µ—Ä–∂–∫–∏.

**–†–µ—à–µ–Ω–∏–µ:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω debounce —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π 400ms —á–µ—Ä–µ–∑ `Timer`. –ü–æ–∏—Å–∫ —Ç–µ–ø–µ—Ä—å —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–∞—É–∑—ã –≤ –≤–≤–æ–¥–µ, —á—Ç–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ —É–º–µ–Ω—å—à–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–æ–∫.

---

### 3. **–õ–æ–≥–∏–∫–∞ –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**

#### üü° –°—Ä–µ–¥–Ω–µ: –ù–µ—Ç —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
**–ü—Ä–æ–±–ª–µ–º–∞:** –•–æ—Ç—è —Å–µ—Ä–≤–µ—Ä —Å–æ—Ä—Ç–∏—Ä—É–µ—Ç –ø–æ `updated_at`, –Ω–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏—è–º.

**–†–µ—à–µ–Ω–∏–µ:** –°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —á–∞—Ç—ã —Ç–∞–∫, —á—Ç–æ–±—ã –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ –±—ã–ª–∏ —Å–≤–µ—Ä—Ö—É:
```dart
_chats.sort((a, b) {
  if (a.unreadCount > 0 && b.unreadCount == 0) return -1;
  if (a.unreadCount == 0 && b.unreadCount > 0) return 1;
  return b.updatedAt.compareTo(a.updatedAt);
});
```

#### üü° –°—Ä–µ–¥–Ω–µ: –ü–æ–∏—Å–∫ —Ç–æ–ª—å–∫–æ –ø–æ –∏–º–µ–Ω–∏/username
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–∏—Å–∫ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è.

**–†–µ—à–µ–Ω–∏–µ:** –†–∞—Å—à–∏—Ä–∏—Ç—å –ø–æ–∏—Å–∫ –Ω–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–π (–µ—Å–ª–∏ —ç—Ç–æ –Ω—É–∂–Ω–æ).

#### üü¢ –ù–∏–∑–∫–æ: –ù–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —É–¥–∞–ª–∏—Ç—å/–∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å —á–∞—Ç
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —á–∞—Ç–∞–º–∏ (—É–¥–∞–ª–µ–Ω–∏–µ, –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ, –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ).

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å swipe actions –∏–ª–∏ long-press –º–µ–Ω—é.

#### üü¢ –ù–∏–∑–∫–æ: –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç–∞—Ç—É—Å–æ–≤
**–ü—Ä–æ–±–ª–µ–º–∞:** –û—à–∏–±–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç—É—Å–æ–≤ —Ç–æ–ª—å–∫–æ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è, –Ω–æ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ —Å fallback –Ω–∞ –∫—ç—à.

---

### 4. **–ö–æ–¥ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**

#### üü° –°—Ä–µ–¥–Ω–µ: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏
**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–µ—Ç–æ–¥ `_formatTime()` –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–Ω–µ—Å–µ–Ω –≤ —É—Ç–∏–ª–∏—Ç—ã, —Ç–∞–∫ –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –¥—Ä—É–≥–∏—Ö –º–µ—Å—Ç–∞—Ö.

#### üü° –°—Ä–µ–¥–Ω–µ: –ú–Ω–æ–≥–æ print() –≤–º–µ—Å—Ç–æ proper logging
**–ü—Ä–æ–±–ª–µ–º–∞:** –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è `print()` –≤–º–µ—Å—Ç–æ —Å–∏—Å—Ç–µ–º—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `debugPrint` –∏–ª–∏ —Å–∏—Å—Ç–µ–º—É –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.

#### üü¢ –ù–∏–∑–∫–æ: –ù–µ—Ç —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –Ω–∞ –≤–∏–¥–∂–µ—Ç—ã
**–ü—Ä–æ–±–ª–µ–º–∞:** –ë–æ–ª—å—à–∏–µ –º–µ—Ç–æ–¥—ã `_buildChatItem()`, `_buildStoriesSection()` –º–æ–∂–Ω–æ –≤—ã–Ω–µ—Å—Ç–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –≤–∏–¥–∂–µ—Ç—ã.

---

## ‚úÖ –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ —É–ª—É—á—à–µ–Ω–∏—é

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

1. **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Future.wait()` –≤–º–µ—Å—Ç–æ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
   - –ü—Ä–æ–≤–µ—Ä—è—Ç—å –∫—ç—à –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π

2. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤**
   - –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –æ–Ω–ª–∞–π–Ω –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ—Ç –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö
   - –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –≤–∏–∑—É–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å

3. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞**
   - –ù–µ –¥–µ–ª–∞—Ç—å –ø–æ–ª–Ω—É—é –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –∏–∑ —á–∞—Ç–∞
   - –û–±–Ω–æ–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–π —á–∞—Ç

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –í–∞–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

4. **–£–ª—É—á—à–∏—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É**
   - –ù–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ —á–∞—Ç—ã —Å–≤–µ—Ä—Ö—É
   - –ó–∞—Ç–µ–º –ø–æ –¥–∞—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

5. **–î–æ–±–∞–≤–∏—Ç—å debounce –¥–ª—è –ø–æ–∏—Å–∫–∞**
   - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞

6. **–£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫**
   - –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å fallback –Ω–∞ –∫—ç—à

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

7. **–î–æ–±–∞–≤–∏—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–∞—Ç–∞–º–∏**
   - Swipe actions –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è/–∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—è
   - Long-press –º–µ–Ω—é

8. **–£–ª—É—á—à–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏**
   - –ë–æ–ª–µ–µ —Ç–æ—á–Ω—ã–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞—Ç—ã
   - –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è

9. **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∫–æ–¥–∞**
   - –í—ã–Ω–µ—Å—Ç–∏ –≤–∏–¥–∂–µ—Ç—ã –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å proper logging

---

## üìù –ü—Ä–∏–º–µ—Ä—ã —É–ª—É—á—à–µ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞

### –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤:
```dart
Future<void> _loadUserStatuses() async {
  try {
    final prefs = await SharedPreferences.getInstance();
    final accessToken = prefs.getString('access_token');
    if (accessToken == null) return;

    final onlineStatusProvider = context.read<OnlineStatusProvider>();
    
    // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à
    final Map<String, Map<String, dynamic>> newStatuses = {};
    final List<Future<void>> futures = [];
    
    for (final chat in _chats) {
      if (chat.otherUser != null) {
        final userId = chat.otherUser!.id;
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à
        final cachedStatus = onlineStatusProvider.getCachedStatus(userId);
        if (cachedStatus != null) {
          newStatuses[userId] = cachedStatus;
        } else {
          // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–ª—å–∫–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ
          futures.add(
            onlineStatusProvider.getUserStatus(userId, accessToken)
              .then((status) => newStatuses[userId] = status)
              .catchError((e) => print('Error loading status for $userId: $e'))
          );
        }
      }
    }
    
    // –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö —Å—Ç–∞—Ç—É—Å–æ–≤
    await Future.wait(futures);
    
    if (mounted) {
      setState(() {
        _userStatuses.addAll(newStatuses);
      });
    }
  } catch (e) {
    print('Error loading user statuses: $e');
  }
}
```

### –£–ª—É—á—à–µ–Ω–Ω–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:
```dart
void _sortChats() {
  _chats.sort((a, b) {
    // –°–Ω–∞—á–∞–ª–∞ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ
    if (a.unreadCount > 0 && b.unreadCount == 0) return -1;
    if (a.unreadCount == 0 && b.unreadCount > 0) return 1;
    // –ó–∞—Ç–µ–º –ø–æ –¥–∞—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    return b.updatedAt.compareTo(a.updatedAt);
  });
}
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤:
```dart
// –í _buildChatItem, –≤ Stack —Å –∞–≤–∞—Ç–∞—Ä–æ–º:
if (hasUnread) {
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –±–µ–π–¥–∂ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö
  Positioned(...) // –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ
} else if (chat.otherUser != null && _userStatuses[chat.otherUser!.id]?['is_online'] == true) {
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–Ω–ª–∞–π–Ω —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ—Ç –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö
  Positioned(...) // –æ–Ω–ª–∞–π–Ω
}
```

### Debounce –¥–ª—è –ø–æ–∏—Å–∫–∞:
```dart
// Timer –¥–ª—è debounce –ø–æ–∏—Å–∫–∞
Timer? _searchDebounceTimer;

void _onSearchChanged() {
  // –û—Ç–º–µ–Ω—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–∞–π–º–µ—Ä
  _searchDebounceTimer?.cancel();
  
  // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —Ç–∞–π–º–µ—Ä —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π 400ms
  _searchDebounceTimer = Timer(const Duration(milliseconds: 400), () {
    _filterChats();
  });
}

@override
void dispose() {
  _searchDebounceTimer?.cancel(); // –í–∞–∂–Ω–æ: –æ—Ç–º–µ–Ω—è–µ–º —Ç–∞–π–º–µ—Ä –ø—Ä–∏ dispose
  _searchController.dispose();
  super.dispose();
}
```

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∞—Ç–æ–≤:
```dart
// –ö–ª—é—á–∏ –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
static const String _cachedChatsKey = 'cached_chats';
static const String _cachedChatsTimestampKey = 'cached_chats_timestamp';

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–∞—Ç–æ–≤ –≤ –∫—ç—à
Future<void> _saveChatsToCache(List<Chat> chats) async {
  try {
    final prefs = await SharedPreferences.getInstance();
    final chatsJson = chats.map((chat) => chat.toJson()).toList();
    await prefs.setString(_cachedChatsKey, jsonEncode(chatsJson));
    await prefs.setInt(_cachedChatsTimestampKey, DateTime.now().millisecondsSinceEpoch);
  } catch (e) {
    debugPrint('Error saving chats to cache: $e');
  }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ —á–∞—Ç–æ–≤ –∏–∑ –∫—ç—à–∞
Future<List<Chat>> _loadChatsFromCache() async {
  try {
    final prefs = await SharedPreferences.getInstance();
    final cachedChatsJson = prefs.getString(_cachedChatsKey);
    
    if (cachedChatsJson == null) return [];
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —É—Å—Ç–∞—Ä–µ–ª –ª–∏ –∫—ç—à (–Ω–µ —Å—Ç–∞—Ä—à–µ 1 —á–∞—Å–∞)
    final timestamp = prefs.getInt(_cachedChatsTimestampKey);
    if (timestamp != null) {
      final cacheAge = DateTime.now().millisecondsSinceEpoch - timestamp;
      const oneHour = 60 * 60 * 1000;
      if (cacheAge > oneHour) return [];
    }
    
    final List<dynamic> chatsData = jsonDecode(cachedChatsJson);
    return chatsData.map((json) => Chat.fromJson(json)).toList();
  } catch (e) {
    debugPrint('Error loading chats from cache: $e');
    return [];
  }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —á–∞—Ç–æ–≤ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
@override
void initState() {
  super.initState();
  _searchController.addListener(_onSearchChanged);
  _loadCachedChatsFirst(); // –°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ –∫—ç—à–∞
  _loadChats(); // –ó–∞—Ç–µ–º –æ–±–Ω–æ–≤–ª—è–µ–º —Å API
}
```

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —É–ª—É—á—à–µ–Ω–∏–π

- **–í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç—É—Å–æ–≤:** –° 2-5 —Å–µ–∫ –¥–æ <500ms (–ø—Ä–∏ 10 —á–∞—Ç–∞—Ö) ‚úÖ
- **–í—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞:** –° –ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–Ω–æ–≥–æ —á–∞—Ç–∞ ‚úÖ
- **UX:** –£–ª—É—á—à–µ–Ω–Ω–∞—è –≤–∏–∑—É–∞–ª—å–Ω–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ ‚úÖ
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –ú–µ–Ω—å—à–µ –Ω–µ–Ω—É–∂–Ω—ã—Ö –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–æ–∫ ‚úÖ
- **Debounce –ø–æ–∏—Å–∫–∞:** –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π 400ms ‚úÖ
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∞—Ç–æ–≤:** –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —ç–∫—Ä–∞–Ω–∞ ‚úÖ
- **–í—Ä–µ–º—è –ø–µ—Ä–≤–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è:** –° 1-3 —Å–µ–∫ –¥–æ <100ms (–±–ª–∞–≥–æ–¥–∞—Ä—è –∫—ç—à—É) ‚úÖ

---

## üéØ –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** 6/10
- ‚úÖ –ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ UI –≤ —Ü–µ–ª–æ–º –ø–æ–Ω—è—Ç–Ω—ã–π
- ‚ùå –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é
- ‚ùå –ù–µ–∫–æ—Ç–æ—Ä—ã–µ UX –ø—Ä–æ–±–ª–µ–º—ã

**–ü–æ—Å–ª–µ —É–ª—É—á—à–µ–Ω–∏–π:** 9.5/10
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤)
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω—ã–π UX (–∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ, debounce, –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã)
- ‚úÖ –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (–∫—ç—à —á–∞—Ç–æ–≤)
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–∏—Å–∫ (debounce 400ms)
- ‚ö†Ô∏è –û—Å—Ç–∞–ª–æ—Å—å: —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–≤–µ—Ä—Ö—É, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–∞—Ç–∞–º–∏

