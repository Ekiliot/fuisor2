# üîî –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ç–∏–ø–æ–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

–í—Å–µ —Ç–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–≥–æ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.

## üìã –°–ø–∏—Å–æ–∫ —Ç–∏–ø–æ–≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### 1. –£–ø–æ–º–∏–Ω–∞–Ω–∏—è (@mentions)
- **–í –ø–æ—Å—Ç–∞—Ö**: –ü—Ä–∏ —É–ø–æ–º–∏–Ω–∞–Ω–∏–∏ `@username` –≤ –æ–ø–∏—Å–∞–Ω–∏–∏ –ø–æ—Å—Ç–∞
- **–í –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö**: –ü—Ä–∏ —É–ø–æ–º–∏–Ω–∞–Ω–∏–∏ `@username` –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
- **–¢–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**: `mention`, `comment_mention`
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∞**: "Mentions in posts", "Mentions in comments"

### 2. –ù–æ–≤—ã–µ –ø–æ—Å—Ç—ã –æ—Ç –ø–æ–¥–ø–∏—Å–æ–∫
- **–ö–æ–≥–¥–∞**: –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–≥–æ –≤—ã –ø–æ–¥–ø–∏—Å–∞–Ω—ã, —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π –ø–æ—Å—Ç
- **–¢–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**: `new_post`
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∞**: "New posts"

### 3. –ü–æ–¥–ø–∏—Å–∫–∏
- **–ö–æ–≥–¥–∞**: –ö–æ–≥–¥–∞ –∫—Ç–æ-—Ç–æ –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –≤–∞—Å
- **–¢–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**: `follow`
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∞**: "Follows"
- **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –£–∂–µ –±—ã–ª–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞, –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ FCM

### 4. Stories –æ—Ç –ø–æ–¥–ø–∏—Å–æ–∫
- **–ö–æ–≥–¥–∞**: –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–≥–æ –≤—ã –ø–æ–¥–ø–∏—Å–∞–Ω—ã, –ø—É–±–ª–∏–∫—É–µ—Ç story
- **–¢–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**: `new_story`
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∞**: "New stories"

### 5. –õ–∞–π–∫–∏ –Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –æ—Ç–≤–µ—Ç—ã
- **–ö–æ–≥–¥–∞**: –ö–æ–≥–¥–∞ –∫—Ç–æ-—Ç–æ —Å—Ç–∞–≤–∏—Ç –ª–∞–π–∫ –Ω–∞ –≤–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∏–ª–∏ –æ—Ç–≤–µ—Ç
- **–¢–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**: `comment_like`
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∞**: "Comment likes"
- **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –î–∏–∑–ª–∞–π–∫–∏ –Ω–µ –≤—ã–∑—ã–≤–∞—é—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### 6. –û—Ç–≤–µ—Ç—ã –Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
- **–ö–æ–≥–¥–∞**: –ö–æ–≥–¥–∞ –∫—Ç–æ-—Ç–æ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
- **–¢–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**: `comment_reply`
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∞**: "Comment replies"

### 7. –õ–∞–π–∫–∏ –Ω–∞ –ø–æ—Å—Ç—ã
- **–ö–æ–≥–¥–∞**: –ö–æ–≥–¥–∞ –∫—Ç–æ-—Ç–æ —Å—Ç–∞–≤–∏—Ç –ª–∞–π–∫ –Ω–∞ –≤–∞—à –ø–æ—Å—Ç
- **–¢–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**: `like`
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∞**: "Likes"
- **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –£–∂–µ –±—ã–ª–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞

### 8. –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –ø–æ—Å—Ç–∞–º
- **–ö–æ–≥–¥–∞**: –ö–æ–≥–¥–∞ –∫—Ç–æ-—Ç–æ –∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–µ—Ç –≤–∞—à –ø–æ—Å—Ç
- **–¢–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**: `comment`
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∞**: "Comments"
- **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –£–∂–µ –±—ã–ª–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –ù–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è
`supabase/migrations/add_notification_types_and_settings.sql`:

1. **–û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `notifications`**: –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ —Ç–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
   - `new_post`
   - `new_story`
   - `comment_reply`
   - `comment_mention`

2. **–°–æ–∑–¥–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `comment_mentions`**: –î–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —É–ø–æ–º–∏–Ω–∞–Ω–∏–π –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö
   - `id` (UUID, PK)
   - `comment_id` (UUID, FK to comments)
   - `mentioned_user_id` (UUID, FK to profiles)
   - `created_at` (TIMESTAMPTZ)

3. **–°–æ–∑–¥–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `notification_preferences`**: –î–ª—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
   - `user_id` (UUID, FK to profiles, UNIQUE)
   - `mention_enabled` (BOOLEAN, default TRUE)
   - `comment_mention_enabled` (BOOLEAN, default TRUE)
   - `new_post_enabled` (BOOLEAN, default TRUE)
   - `new_story_enabled` (BOOLEAN, default TRUE)
   - `follow_enabled` (BOOLEAN, default TRUE)
   - `like_enabled` (BOOLEAN, default TRUE)
   - `comment_enabled` (BOOLEAN, default TRUE)
   - `comment_reply_enabled` (BOOLEAN, default TRUE)
   - `comment_like_enabled` (BOOLEAN, default TRUE)

4. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫**: –¢—Ä–∏–≥–≥–µ—Ä —Å–æ–∑–¥–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üîß Backend –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã
- `src/utils/notification_preferences.js` - –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- `src/utils/mention_utils.js` - –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —É–ø–æ–º–∏–Ω–∞–Ω–∏–π –∏–∑ —Ç–µ–∫—Å—Ç–∞

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- `src/routes/notification.routes.js` - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
- `src/routes/post.routes.js`:
  - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ—Å—Ç–∞/story
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π –≤ –æ–ø–∏—Å–∞–Ω–∏–∏ –ø–æ—Å—Ç–∞
  - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –æ—Ç–≤–µ—Ç–∞—Ö –Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
  - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è—Ö –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö
- `src/routes/follow.routes.js` - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `createNotification` —Å FCM
- `src/routes/user.routes.js` - API endpoints –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### –ù–æ–≤—ã–µ API endpoints
- `GET /api/users/notification-preferences` - –ü–æ–ª—É—á–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- `PUT /api/users/notification-preferences` - –û–±–Ω–æ–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## üì± Frontend –∏–∑–º–µ–Ω–µ–Ω–∏—è

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã
- `fuisor_app/lib/screens/notification_settings_screen.dart` - –≠–∫—Ä–∞–Ω –Ω–∞—Å—Ç—Ä–æ–µ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- `fuisor_app/lib/screens/settings_screen.dart` - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ —ç–∫—Ä–∞–Ω –Ω–∞—Å—Ç—Ä–æ–µ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- `fuisor_app/lib/services/api_service.dart` - –ú–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## üéØ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∏—Å—Ç–µ–º–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π**: –ü–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ `isNotificationEnabled()`
2. **–ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é**: –í—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–∫–ª—é—á–µ–Ω—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (TRUE)
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ**: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è
4. **–û—Ç–∫–ª—é—á–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π**: –ï—Å–ª–∏ —Ç–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–∫–ª—é—á–µ–Ω, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∏ FCM –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### Backend: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
```javascript
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≤ createNotification()
await createNotification(userId, actorId, 'new_post', postId);
// –ï—Å–ª–∏ new_post_enabled = false, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–µ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–æ
```

### Frontend: –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
```dart
final preferences = await _apiService.getNotificationPreferences();
bool mentionEnabled = preferences['mention_enabled'] ?? true;
```

### Frontend: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
```dart
await _apiService.updateNotificationPreferences({
  'mention_enabled': false,
  'new_post_enabled': true,
});
```

## üöÄ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

1. **–ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é**:
   ```sql
   -- –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤ Supabase SQL Editor
   -- supabase/migrations/add_notification_types_and_settings.sql
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É**:
   - –°–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç —Å —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ–º `@username`
   - –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –ü—Ä–æ–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å—Ç
   - –û—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
   - –ü–æ—Å—Ç–∞–≤–∏—Ç—å –ª–∞–π–∫ –Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π

## üìç –ì–¥–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

**Settings ‚Üí General ‚Üí Notification Settings**

–¢–∞–º –º–æ–∂–Ω–æ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –∫–∞–∂–¥—ã–π —Ç–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.

